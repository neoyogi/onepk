<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--
 | Generated by Apache Maven Doxia at Aug 18, 2014
 | Rendered using Apache Maven Fluido Skin 1.2.2
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>onePK Python Tutorials - Routing Service Set Tutorial - Reading RIB routes, updating application routes, adding listeners for route up and down events in the RIB,
and adding listeners for application routes.</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido.min.js"></script>

    
    <meta http-equiv="Content-Language" content="en" />
            </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>onePK Python Tutorials</h2>
                </div>
                      </div>
        <div class="pull-right">                  <a href="http://www.cisco.com/go/onepk" id="bannerRight">
                                                                                                <img src="../images/cisco-logo.png" />
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
            
                  <li id="publishDate">Last Published: 2014-08-18</li>
                  <li class="divider">|</li> <li id="projectVersion">Version: 1.3.0.181</li>
                      
                
            
      
                            </ul>
      </div>

            <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
                
            
                                    <h3>Main</h3>
                  <ul>
                  <li class="none">
                          <a href="../index.html" title="Home">Home</a>
            </li>
          </ul>
                        <h3>Tutorials</h3>
                  <ul>
                  <li class="none">
                          <a href=".././basetutorial.html" title="Connecting to a Network Element">Connecting to a Network Element</a>
            </li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <li class="expanded">
                          <a href="../index.html#Base_Service_Set_Tutorials" title="Base Service Set Tutorials">Base Service Set Tutorials</a>
                    <ul>
                                                                        <li class="collapsed">
                          <a href="../SessionTutorial/SessionTutorials.html" title="Session Handling">Session Handling</a>
                  </li>
                                                                                                            <li class="collapsed">
                          <a href="../NetworkElement/networkelement.html" title="Element">Element</a>
                  </li>
                                                                                                                                                <li class="collapsed">
                          <a href="../NetworkInterface/networkinterface.html" title="Network Interface">Network Interface</a>
                  </li>
                                                                                                                                                                  <li class="collapsed">
                          <a href="../Events/events.html" title="Events">Events</a>
                  </li>
                                                                                          <li class="collapsed">
                          <a href="../Discovery/discovery.html" title="Discovery">Discovery</a>
                  </li>
                                                                                          <li class="collapsed">
                          <a href="../Management/management.html" title="Application CLI Extension">Application CLI Extension</a>
                  </li>
                                                                                          <li class="collapsed">
                          <a href="../AAATutorial/AAAOverview.html" title="AAA">AAA</a>
                  </li>
                                                                        <li class="collapsed">
                          <a href="../VTYTutorial/vty.html" title="VTY">VTY</a>
                  </li>
                                                                                          <li class="collapsed">
                          <a href="../Policy/policy.html" title="Policy">Policy</a>
                  </li>
                                                                                                    <li class="expanded">
                          <a href="../Routing/routing.html" title="Routing">Routing</a>
                    <ul>
                      <li class="none">
                          <a href="../Routing/ArtTutorial.html" title="Routing ART Tutorial">Routing ART Tutorial</a>
            </li>
                      <li class="none">
            <strong>Routing RIB Tutorial</strong>
          </li>
              </ul>
        </li>
                                                                        <li class="collapsed">
                          <a href="../Location/location.html" title="Location">Location</a>
                  </li>
                                                                        <li class="collapsed">
                          <a href="../Identity/identity.html" title="Identity">Identity</a>
                  </li>
              </ul>
        </li>
          </ul>
                      
            
                
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
        <div id="bodyColumn"  class="span10" >
                                  
            <div class="section"><h2><a name="Basic_RIB_Tutorial">Basic RIB Tutorial</a></h2>
<p><a href="http://developer.cisco.com/web/onepk/community" class="externalLink">For questions, read the onePK Forums</a></p>
<p><b>Contents</b></p>
<ul><li><a href="#Basic_RIB_Tutorial">Basic RIB Tutorial</a></li>
<li><a href="#Goal">Goal</a></li>
<li><a href="#Tutorial_Code">Tutorial Code</a></li>
<li><a href="#RequirementsPrerequisites">Requirements/Prerequisites</a></li>
<li><a href="#Steps_In_Detail">Steps In Detail</a><ul><li><a href="#Example_RIB_Route_Listener">Example RIB Route Listener</a></li>
<li><a href="#Get_RIB_Table">Get RIB Table</a></li>
<li><a href="#Add_RIB_Route_Listener">Add RIB Route Listener</a></li>
<li><a href="#Remove_RIB_Route_Listener">Remove RIB Route Listener</a></li>
</ul>
</li>
<li><a href="#Result">Result</a></li>
<li><a href="#Next_Steps">Next Steps</a></li>
</ul>
</div>
<div class="section"><h2><a name="Goal">Goal</a></h2>
<p>This tutorial shows you how to read RIB (Routing Information Base) routes, update application routes, add listeners for route up and down events in the RIB, and add listeners for application routes.</p>
</div>
<div class="section"><h2><a name="Tutorial_Code">Tutorial Code</a></h2>
<p>The code used in this tutorial is available in the RIBTutorial.py file located under &lt;SDK Location&gt;/python/tutorials/src/routing/RIBTutorial.py. </p>
</div>
<div class="section"><h2><a name="RequirementsPrerequisites">Requirements/Prerequisites</a></h2>
<p>These steps assume the application can connect properly to a network element. Please see the <a href="../basetutorial.html">Connecting to a Network Element</a> tutorial for information on how to make the initial connection.</p>
</div>
<div class="section"><h2><a name="Steps_In_Detail">Steps In Detail</a></h2>
<div class="section"><h3><a name="Example_RIB_Route_Listener">Example RIB Route Listener</a></h3>
<p>First, create a RIB Route Listener that listens to RIB Route events.</p>
<div class="source"><pre class="prettyprint">    class ExampleRIBRouteListener(RIBRouteStateListener):
        &quot;&quot;&quot;
        RIBRouteStateListener implemented as inner class.
        &quot;&quot;&quot;
        
        def handleEvent(self, event, clientData):
            
            logger.info(&quot;RIBRouteStateEvent received...&quot;)
            logger.info(&quot;Scope: &quot; + event.scope)
            logger.info(&quot;Route: &quot; + event.route)
            
            state = event.state
            logger.info(&quot;State : &quot;)
            logger.info(RIB.RouteState.enumval(state))
            
            art_event_route = event.route
            nexthoplist = art_event_route.next_hop_list
            for next_hop in nexthoplist:
                try :
                    ni = next_hop.network_interface          
                    na = next_hop.address
                except OnepRemoteProcedureException, e:
                    print &quot;N/A: &quot; + e 
                except OnepConnectionException, e:
                    print str(e)    
                else:
                    print &quot;NextHop ip address is &quot; + na 
                    if ni is not None:
                        print ni.name

</pre>
</div>
</div>
<div class="section"><h3><a name="Get_RIB_Table">Get RIB Table</a></h3>
<p>Next, get the RIB Table from the network element.</p>
<div class="source"><pre class="prettyprint">#  Create a Routing object for the network element.
routing = Routing.getInstance(tutorial.get_network_element())
#  Get the instance of the RIB table.
rib = routing.getRib()
return rib
</pre>
</div>
</div>
<div class="section"><h3><a name="Add_RIB_Route_Listener">Add RIB Route Listener</a></h3>
<p>Next, apply the RIB listener that you created earlier.</p>
<div class="source"><pre class="prettyprint">        aL3UnicastScope = L3UnicastScope(&quot;&quot;, L3UnicastScope.AFIType.IPV4 , 
                                            L3UnicastScope.SAFIType.UNICAST, 
                                            &quot;&quot;)
        rib_filter = L3UnicastRIBFilter()
        #  Add a listener to receive route state change events.
        #  When events arrive, listener.handleEvent() will be invoked.
        exampleRIBRouteListener = self.ExampleRIBRouteListener()
        logger.info(&quot;adding RIB listener...&quot;)
#         exampleRIBRouteListenerEventHandle = None
        exampleRIBRouteListenerEventHandle = rib.add_route_state_listener(
                                                exampleRIBRouteListener, 
                                                aL3UnicastScope, 
                                                rib_filter, 
                                                0, 
                                                None);
        logger.info(str(exampleRIBRouteListenerEventHandle))
        return exampleRIBRouteListenerEventHandle
</pre>
</div>
</div>
<div class="section"><h3><a name="Remove_RIB_Route_Listener">Remove RIB Route Listener</a></h3>
<p>Finally, at the end of your routing tutorial, remove the RIB Route Listener.</p>
<div class="source"><pre class="prettyprint">#  Remove RIB listener.
rib.remove_route_state_listener(eventHandler)
</pre>
</div>
</div>
</div>
<div class="section"><h2><a name="Result">Result</a></h2>
<p>Congratulations! You are now able to use your onePK application to create routing objects, add application routes, receive notification for route up/down events in the RIB, and also receive application route promote/demote events.</p>
<p>To try out this tutorial code by compiling and running it, you can find the code located in the directory &lt;SDK Location&gt;/tutorials/python/routing/RibTutorial.</p>
</div>
<div class="section"><h2><a name="Next_Steps">Next Steps</a> </h2>
<ul><li><a href="../Events/SyslogEventTutorial.html">Syslog Events Tutorial</a></li>
<li><a href="../NetworkInterface/networkinterfacetutorial.html">Accessing Network Interfaces Tutorial</a></li>
<li><a href="../NetworkInterface/interfacestatechangetutorial.html">Interface State Change Tutorial</a></li>
<li><a href="../NetworkInterface/interfacestatisticstutorial.html">Interface Statistics Tutorial</a> </li>
</ul>
</div>

                  </div>
            </div>
      
    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                   2014.
          All Rights Reserved.      
            
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
