<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--
 | Generated by Apache Maven Doxia at Aug 18, 2014
 | Rendered using Apache Maven Fluido Skin 1.2.2
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>onePK Python Tutorials - onePK CLI Event Tutorials - Registering for CLI (Command Line Interface) commands Events.</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido.min.js"></script>

    
    <meta http-equiv="Content-Language" content="en" />
            </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>onePK Python Tutorials</h2>
                </div>
                      </div>
        <div class="pull-right">                  <a href="http://www.cisco.com/go/onepk" id="bannerRight">
                                                                                                <img src="../images/cisco-logo.png" />
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
            
                  <li id="publishDate">Last Published: 2014-08-18</li>
                  <li class="divider">|</li> <li id="projectVersion">Version: 1.3.0.181</li>
                      
                
            
      
                            </ul>
      </div>

            <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
                
            
                                    <h3>Main</h3>
                  <ul>
                  <li class="none">
                          <a href="../index.html" title="Home">Home</a>
            </li>
          </ul>
                        <h3>Tutorials</h3>
                  <ul>
                  <li class="none">
                          <a href=".././basetutorial.html" title="Connecting to a Network Element">Connecting to a Network Element</a>
            </li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <li class="expanded">
                          <a href="../index.html#Base_Service_Set_Tutorials" title="Base Service Set Tutorials">Base Service Set Tutorials</a>
                    <ul>
                                                                        <li class="collapsed">
                          <a href="../SessionTutorial/SessionTutorials.html" title="Session Handling">Session Handling</a>
                  </li>
                                                                                                            <li class="collapsed">
                          <a href="../NetworkElement/networkelement.html" title="Element">Element</a>
                  </li>
                                                                                                                                                <li class="collapsed">
                          <a href="../NetworkInterface/networkinterface.html" title="Network Interface">Network Interface</a>
                  </li>
                                                                                                                                                                            <li class="expanded">
                          <a href="../Events/events.html" title="Events">Events</a>
                    <ul>
                      <li class="none">
                          <a href="../Events/SyslogEventTutorial.html" title="Syslog Events Tutorial">Syslog Events Tutorial</a>
            </li>
                      <li class="none">
            <strong>CLI Events Tutorial</strong>
          </li>
                      <li class="none">
                          <a href="../Events/CDPEventTutorial.html" title="CDP Events Tutorial">CDP Events Tutorial</a>
            </li>
                      <li class="none">
                          <a href="../NetworkInterface/interfacestatisticstutorial.html" title="Interface Statistics Events Tutorial">Interface Statistics Events Tutorial</a>
            </li>
                      <li class="none">
                          <a href="../NetworkInterface/interfacestatechangetutorial.html" title="Interface State Change Events Tutorial">Interface State Change Events Tutorial</a>
            </li>
                      <li class="none">
                          <a href="../NetworkInterface/interfacecdptutorial.html" title="Interface CDP Events Tutorial">Interface CDP Events Tutorial</a>
            </li>
              </ul>
        </li>
                                                                                          <li class="collapsed">
                          <a href="../Discovery/discovery.html" title="Discovery">Discovery</a>
                  </li>
                                                                                          <li class="collapsed">
                          <a href="../Management/management.html" title="Application CLI Extension">Application CLI Extension</a>
                  </li>
                                                                                          <li class="collapsed">
                          <a href="../AAATutorial/AAAOverview.html" title="AAA">AAA</a>
                  </li>
                                                                        <li class="collapsed">
                          <a href="../VTYTutorial/vty.html" title="VTY">VTY</a>
                  </li>
                                                                                          <li class="collapsed">
                          <a href="../Policy/policy.html" title="Policy">Policy</a>
                  </li>
                                                                                          <li class="collapsed">
                          <a href="../Routing/routing.html" title="Routing">Routing</a>
                  </li>
                                                                        <li class="collapsed">
                          <a href="../Location/location.html" title="Location">Location</a>
                  </li>
                                                                        <li class="collapsed">
                          <a href="../Identity/identity.html" title="Identity">Identity</a>
                  </li>
              </ul>
        </li>
          </ul>
                      
            
                
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
        <div id="bodyColumn"  class="span10" >
                                  
            <div class="section"><h2><a name="CLI_Commands_Events_Tutorial">CLI Commands Events Tutorial</a></h2>
<p><a href="mailto:onePK-feedback@cisco.com?subject=Python tutorials" class="externalLink">Feedback</a></p>
<p><b>Contents</b></p>
<ul><li><a href="#CLI_Commands_Events_Tutorial">CLI Commands Events Tutorial</a></li>
<li><a href="#Goal">Goal</a></li>
<li><a href="#Tutorial_Code">Tutorial Code</a></li>
<li><a href="#RequirementsPrerequisites">Requirements/Prerequisites</a></li>
<li><a href="#Network_Configuration">Network Configuration</a></li>
<li><a href="#Steps_In_Detail">Steps In Detail</a></li>
<li><a href="#Result">Result</a></li>
<li><a href="#Next_Steps">Next Steps</a></li>
</ul>
</div>
<div class="section"><h2><a name="Goal">Goal</a></h2>
<p>This tutorial shows how a onePK application can register to receive CLI (Command Line Interface) command events that run on the network element it is connected to. When CLI commands are entered on the network element, they are sent to the registered onePK application through a callback mechanism. The callback handler in this tutorial demonstrates how to handle a CLI event and alter its default behavior.</p>
</div>
<div class="section"><h2><a name="Tutorial_Code">Tutorial Code</a></h2>
<p>For this tutorial, you use the CliEventTutorial as a general guide for onePK CLI events.</p>
<p>The code used in this tutorial is available in the CliEventTutorial.py file located under &lt;SDK Location&gt;/python/tutorials/events</p>
</div>
<div class="section"><h2><a name="RequirementsPrerequisites">Requirements/Prerequisites</a></h2>
<ul><li>These steps assume the application can connect properly to a network element. Please see the <a href="../basetutorial.html">Connecting to a Network Element</a> tutorial for information on how to make the initial connection.</li>
<li><b>For NX-OS platforms only:</b> To configure the network element to run an Events tutorial, you must first enable the EVMED feature, which allows developers to use Embedded Event Manager (EEM) to monitor Application-, CLI-, and Interface Statistics-based events and then schedule actions on the occurrence of those events:</li>
</ul>
<div class="source"><pre class="prettyprint">router(config)# feature evmed
router(config)# sh feature |i evmed
evmed           1               enabled</pre>
</div>
</div>
<div class="section"><h2><a name="Network_Configuration">Network Configuration</a></h2>
<p>If onePK is enabled on the network element, and a connection by the application is possible, no further configuration is needed to register for events. The events infrastructure for onePK is provided on the network element by the Embedded Event Manager (EEM) infrastructure. Various EEM commands can be run to show information such as registered events and an event history.</p>
<div class="source"><pre class="prettyprint">NE100# show event manager policy registered
NE100# show event manager history events</pre>
</div>
</div>
<div class="section"><h2><a name="Steps_In_Detail">Steps In Detail</a></h2>
<p>For every event, there is always a listener. The main purpose of a listener is to handle any incoming events from the network element. All listeners in the onePK API are Python Interfaces in which the application developer is responsible for writing concrete methods to handle the incoming onePK events. </p>
<p>The CLI event listener must implement the inherited abstract methods get_sync_reply(), handle_sync_event() and handle_event(). The following example shows a basic implementation of the CLIListener. In this example, you handle the event by altering the behavior of the <b>show location</b> CLI command (as specified during the registration of the listener) by altering its output string.</p>
<div class="section"><h3><a name="Example_Listener">Example Listener</a></h3>
<div class="source"><pre class="prettyprint">class ExampleCliListener(CLIListener):
    
    name = ''

    &quot;&quot;&quot;
      Creates an Example CLI Event Listener.
      @param name
            Identifies the instance.
    &quot;&quot;&quot;
    def __init__(self, name):        
        super(ExampleCliListener, self).__init__()
        self.name = name

    &quot;&quot;&quot;
      Invoked when an event is received from a network element.
      @param event
                 An event object that indicates that an event has occurred in a network element.
      @param clientData
                 The clientData is an object that is passed in when the application calls an API to add/register
                 the event listener. The application is responsible for casting the input clientData to the
                 appropriate class before using it.
    &quot;&quot;&quot;     
    def handle_event(self,event,clientData):
        print &quot;---------------------------&quot;
        print &quot;CLI Event: handle_event\n&quot;
        print &quot; eventHandle&quot; + str(event.event_handle)
        print &quot; msgCount = &quot; + str(event.msg_count)
        print &quot; sync = &quot; + str(event.sync)
        print &quot; sync = &quot; + str(event.tty)
        print &quot; message = &quot; + event.message
        print &quot;---------------------------\n&quot;
    
    &quot;&quot;&quot;
      Invoked when a sync event is received from a network element.
      @param event
                 An event object that indicates that an event has occurred in a network element.
      @param clientData
                 The clientData is an object that is passed in when the application calls an API to add/register
                 the event listener. The application is responsible for casting the input clientData to the
                 appropriate class before using it.
    &quot;&quot;&quot;     
    def handle_sync_event(self,event,clientData):
        print &quot;---------------------------&quot;
        print &quot;CLI Event: handle_sync_event\n&quot;
        print &quot; eventHandle&quot; + str(event.event_handle)
        print &quot; msgCount = &quot; + str(event.msg_count)
        print &quot; sync = &quot; + str(event.sync)
        print &quot; sync = &quot; + str(event.tty)
        print &quot; message = &quot; + event.message
        print &quot;---------------------------\n&quot;
    def get_sync_reply(self):
        print &quot;---------------------------&quot;
        print &quot;CLI Event: get_sync_reply\n&quot;
        print &quot;---------------------------\n&quot;
</pre>
</div>
<p>Next, you register the listener that you have created with the onePK-enabled network element. In order to register the listener, you need a CliFilter object with a specified regular expression pattern. CLI commands matching this pattern will trigger the event and the listener's get_sync_reply() function will be run synchronously with the default command. Additionally the clientData (client context) can be passed in as the last parameter to the registration. This data is passed to the callback handler when the registered event triggers. Finally you receive back a handler in the form of a Python integer. </p>
</div>
<div class="section"><h3><a name="Register_Listener">Register Listener</a></h3>
<div class="source"><pre class="prettyprint">cliListener = ExampleCliListener(&quot;CLI event listener&quot;)
cliFilter = CLIFilter('clock')
clientData = None          
network_element = tutorial.get_network_element()
#
# Add a CLI event listener
#
print &quot;Adding a CLI event listener'&quot;
eventHandle = network_element.add_cli_listener(cliListener, cliFilter, clientData)
print &quot;To verify please enter 'show clock' command on the connected device&quot;
</pre>
</div>
<p>You can then remove the listener by passing back the integer that you just received to the corresponding remove listener method. <tt>NOTE</tt> The listener is removed automatically once the onePK application terminates.</p>
</div>
<div class="section"><h3><a name="Remove_Listener">Remove Listener</a></h3>
<div class="source"><pre class="prettyprint">network_element.remove_cli_listener(eventHandle)
</pre>
</div>
<p>By using the same network_element object, you can register multiple listeners to the same network element. For a complete list of listener types that can be added to the network_element object, see the onePK network_element ePydoc documentation.</p>
</div>
</div>
<div class="section"><h2><a name="Result">Result</a></h2>
<p>Congratulations! By following this tutorial, you can now model an events listener on a network element.</p>
</div>
<div class="section"><h2><a name="Next_Steps">Next Steps</a></h2>
<ul><li><a href="./CDPEventTutorial.html">CDP Events Tutorial</a></li>
<li><a href="./OIREventTutorial.html">OIR Events Tutorial</a></li>
<li><a href="./SyslogEventTutorial.html">Syslog Events Tutorial</a></li>
<li><a href="../NetworkInterface/networkinterfacetutorial.html">Basic Network Interface Tutorial</a></li>
<li><a href="../NetworkInterface/interfaceaddresstutorial.html">Interface Address Tutorial</a></li>
<li><a href="../NetworkInterface/interfacestatechangetutorial.html">Interface State Change Tutorial</a></li>
<li><a href="../NetworkInterface/interfacestatisticstutorial.html">Interface Statistics Tutorial</a></li>
</ul>
</div>

                  </div>
            </div>
      
    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                   2014.
          All Rights Reserved.      
            
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
