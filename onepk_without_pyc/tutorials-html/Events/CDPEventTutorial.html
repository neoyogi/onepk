<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--
 | Generated by Apache Maven Doxia at Aug 18, 2014
 | Rendered using Apache Maven Fluido Skin 1.2.2
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>onePK Python Tutorials - onePK CDP Event Tutorials - Registering for CDP (Cisco Discovery Protocol) Events.</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido.min.js"></script>

    
    <meta http-equiv="Content-Language" content="en" />
            </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>onePK Python Tutorials</h2>
                </div>
                      </div>
        <div class="pull-right">                  <a href="http://www.cisco.com/go/onepk" id="bannerRight">
                                                                                                <img src="../images/cisco-logo.png" />
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
            
                  <li id="publishDate">Last Published: 2014-08-18</li>
                  <li class="divider">|</li> <li id="projectVersion">Version: 1.3.0.181</li>
                      
                
            
      
                            </ul>
      </div>

            <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
                
            
                                    <h3>Main</h3>
                  <ul>
                  <li class="none">
                          <a href="../index.html" title="Home">Home</a>
            </li>
          </ul>
                        <h3>Tutorials</h3>
                  <ul>
                  <li class="none">
                          <a href=".././basetutorial.html" title="Connecting to a Network Element">Connecting to a Network Element</a>
            </li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <li class="expanded">
                          <a href="../index.html#Base_Service_Set_Tutorials" title="Base Service Set Tutorials">Base Service Set Tutorials</a>
                    <ul>
                                                                        <li class="collapsed">
                          <a href="../SessionTutorial/SessionTutorials.html" title="Session Handling">Session Handling</a>
                  </li>
                                                                                                            <li class="collapsed">
                          <a href="../NetworkElement/networkelement.html" title="Element">Element</a>
                  </li>
                                                                                                                                                <li class="collapsed">
                          <a href="../NetworkInterface/networkinterface.html" title="Network Interface">Network Interface</a>
                  </li>
                                                                                                                                                                            <li class="expanded">
                          <a href="../Events/events.html" title="Events">Events</a>
                    <ul>
                      <li class="none">
                          <a href="../Events/SyslogEventTutorial.html" title="Syslog Events Tutorial">Syslog Events Tutorial</a>
            </li>
                      <li class="none">
                          <a href="../Events/CLIEventTutorial.html" title="CLI Events Tutorial">CLI Events Tutorial</a>
            </li>
                      <li class="none">
            <strong>CDP Events Tutorial</strong>
          </li>
                      <li class="none">
                          <a href="../NetworkInterface/interfacestatisticstutorial.html" title="Interface Statistics Events Tutorial">Interface Statistics Events Tutorial</a>
            </li>
                      <li class="none">
                          <a href="../NetworkInterface/interfacestatechangetutorial.html" title="Interface State Change Events Tutorial">Interface State Change Events Tutorial</a>
            </li>
                      <li class="none">
                          <a href="../NetworkInterface/interfacecdptutorial.html" title="Interface CDP Events Tutorial">Interface CDP Events Tutorial</a>
            </li>
              </ul>
        </li>
                                                                                          <li class="collapsed">
                          <a href="../Discovery/discovery.html" title="Discovery">Discovery</a>
                  </li>
                                                                                          <li class="collapsed">
                          <a href="../Management/management.html" title="Application CLI Extension">Application CLI Extension</a>
                  </li>
                                                                                          <li class="collapsed">
                          <a href="../AAATutorial/AAAOverview.html" title="AAA">AAA</a>
                  </li>
                                                                        <li class="collapsed">
                          <a href="../VTYTutorial/vty.html" title="VTY">VTY</a>
                  </li>
                                                                                          <li class="collapsed">
                          <a href="../Policy/policy.html" title="Policy">Policy</a>
                  </li>
                                                                                          <li class="collapsed">
                          <a href="../Routing/routing.html" title="Routing">Routing</a>
                  </li>
                                                                        <li class="collapsed">
                          <a href="../Location/location.html" title="Location">Location</a>
                  </li>
                                                                        <li class="collapsed">
                          <a href="../Identity/identity.html" title="Identity">Identity</a>
                  </li>
              </ul>
        </li>
          </ul>
                      
            
                
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
        <div id="bodyColumn"  class="span10" >
                                  
            <div class="section"><h2><a name="CDP_Events_Tutorial">CDP Events Tutorial</a></h2>
<p><a href="mailto:onePK-feedback@cisco.com?subject=Python tutorials" class="externalLink">Feedback</a></p>
<p><b>Contents</b></p>
<ul><li><a href="#CDP_Events_Tutorial">CDP Events Tutorial</a></li>
<li><a href="#Goal">Goal</a></li>
<li><a href="#Tutorial_Code">Tutorial Code</a></li>
<li><a href="#RequirementsPrerequisites">Requirements/Prerequisites</a></li>
<li><a href="#Network_Configuration">Network Configuration</a></li>
<li><a href="#Steps_In_Detail">Steps In Detail</a></li>
<li><a href="#Result">Result</a></li>
<li><a href="#Next_Steps">Next Steps</a></li>
</ul>
</div>
<div class="section"><h2><a name="Goal">Goal</a></h2>
<p>This tutorial shows how a onePK application can register to receive CDP (Cisco Discovery Protocol) events from the network element it is connected to. As a CDP-configured network element sends periodic messages to a multicast address, these messages are sent to the registered onePK application through a callback mechanism.</p>
</div>
<div class="section"><h2><a name="Tutorial_Code">Tutorial Code</a></h2>
<p>For this tutorial, you use the CDPEventTutorial as a general guide for onePK CDP events.</p>
<p>The code used in this tutorial is available in the CDPEventTutorial.py file located under &lt;SDK Location&gt;/python/tutorials/events</p>
</div>
<div class="section"><h2><a name="RequirementsPrerequisites">Requirements/Prerequisites</a></h2>
<ul><li>These steps assume the application can connect properly to a network element. Please see the <a href="../basetutorial.html">Connecting to a Network Element</a> tutorial for information on how to make the initial connection.</li>
<li><b>For NX-OS platforms only:</b> To configure the network element to run an Events tutorial, you must first enable the EVMED feature, which allows developers to use Embedded Event Manager (EEM) to monitor Application-, CLI-, and Interface Statistics-based events and then schedule actions on the occurrence of those events:</li>
</ul>
<div class="source"><pre class="prettyprint">router(config)# feature evmed
router(config)# sh feature |i evmed
evmed           1               enabled</pre>
</div>
</div>
<div class="section"><h2><a name="Network_Configuration">Network Configuration</a></h2>
<p>If onePK is enabled on the network element, and a connection by the application is possible, no further configuration is needed to register for events. The events infrastructure for onePK is provided on the network element by the Embedded Event Manager (EEM) infrastructure. Various EEM commands can be run to show information such as registered events and an event history.</p>
<div class="source"><pre class="prettyprint">NE100# show event manager policy registered
NE100# show event manager history events</pre>
</div>
</div>
<div class="section"><h2><a name="Steps_In_Detail">Steps In Detail</a></h2>
<p>For every event, there is always a listener. The main purpose of a listener is to handle any incoming events from the Network Element. All listeners in the onePK API are Python Interfaces in which the application developer is responsible for writing concrete methods to handle the incoming onePK events. The following example shows a basic implementation of the CDPListener. In this example, you handle the event by printing out the CDP details that have been received by the event.</p>
<div class="section"><h3><a name="Example_Listener">Example Listener</a></h3>
<div class="source"><pre class="prettyprint">class ExampleNeCDPListener(CDPListener):
    
    name = str()

    def __init__(self, name):        
        super(ExampleNeCDPListener, self).__init__()
        self.name = name
        
    &quot;&quot;&quot;
      Invoked when an event is received from a network element.
      @param event
                 An event object that indicates that an event has occurred in a network element.
      @param clientData
                 The clientData is an object that is passed in when the application calls an API to add/register
                 the event listener. The application is responsible for casting the input clientData to the
                 appropriate class before using it.
    &quot;&quot;&quot;     
    def handle_event(self, event, clientData):
        print &quot;---------------------------&quot;
        print CDPEvent.CDPEventNotifyType.enumval(event.notify_type)
        print &quot;---------------------------&quot;
        print &quot;NetworkInterface = &quot; + str(event.intf)
        print &quot;neighbor  = &quot; + str(event.device_id)
        print &quot;platform = &quot; + event.platform
        print &quot;version = &quot; + event.version
        print &quot;capabilitites = &quot; + event.capabilities
        print &quot;---------------------------\n&quot;

</pre>
</div>
<p>Next, you register the listener that you have created to the onePK-enabled network element. In order to register the listener, you need a CDPFilter and an InterfaceFilter object to get notification for a specific CDP event type on a specific interface type. </p>
<p>In this example CDPFilter is set to the <b>ONEP_CDP_ALL</b> notification type. Other notification types are as follows:</p>
<ul><li><b>ONEP_CDP_ADD</b></li>
<li><b>ONEP_CDP_DELETE</b></li>
<li><b>ONEP_CDP_UPDATE</b></li>
</ul>
<p>In this example the InterfaceFilter is set on <b>ONEP_IF_TYPE_ETHERNET</b> interface type. Other interface types are as follows:</p>
<ul><li><b>ONEP_IF_TYPE_ANY</b> all types</li>
<li><b>ONEP_IF_TYPE_ATM</b> ATM interface</li>
<li><b>ONEP_IF_TYPE_ETHER_CHANNEL</b> Ethernet channel interface</li>
<li><b>ONEP_IF_TYPE_ETHERNET</b> Ethernet interface</li>
<li><b>ONEP_IF_TYPE_FRAME_RELAY</b> Frame relay interface</li>
<li><b>ONEP_IF_TYPE_GIGABIT_ETHERNET</b> Gigabit ethernet interface</li>
<li><b>ONEP_IF_TYPE_HDLC</b> HDLC interface</li>
<li><b>ONEP_IF_TYPE_LOOPBACK</b> Loopback interface</li>
<li><b>ONEP_IF_TYPE_MLP_BUNDLE</b> MLP bundle interface</li>
<li><b>ONEP_IF_TYPE_MULTI_LINK</b> Multi-link interface</li>
<li><b>ONEP_IF_TYPE_NATIVE_VLAN</b> Native VLAN interface</li>
<li><b>ONEP_IF_TYPE_NULL</b> Null interface</li>
<li><b>ONEP_IF_TYPE_P2P</b> Point to point interface</li>
<li><b>ONEP_IF_TYPE_POS</b> POS interface</li>
<li><b>ONEP_IF_TYPE_POS_CHANNEL</b> POS channel interface</li>
<li><b>ONEP_IF_TYPE_PPP</b> PPP interface</li>
<li><b>ONEP_IF_TYPE_PSEUDOWIRE</b> Psuedowire interface</li>
<li><b>ONEP_IF_TYPE_SERIAL</b> Serial interface</li>
<li><b>ONEP_IF_TYPE_TE</b> Traffic Engineering (TE) interface</li>
<li><b>ONEP_IF_TYPE_TUNNEL</b> Tunnel interface</li>
<li><b>ONEP_IF_TYPE_UNSUPPORTED</b> Reserved</li>
<li><b>ONEP_IF_TYPE_VLAN</b> VLAN interface</li>
<li><b>ONEP_IF_TYPE_WIRELESS</b> Wireless interface </li>
</ul>
<p>Additionally the clientData (client context) can be passed in as the last parameter to the registration. This data is passed to the callback handler when the registered event triggers. Finally you receive back a handler in the form of a Python integer. </p>
</div>
<div class="section"><h3><a name="Register_Listener">Register Listener</a></h3>
<div class="source"><pre class="prettyprint">cdpListener = ExampleNeCDPListener(&quot;CDP Tutorial&quot;)
cdpFilter = CDPFilter()
cdpFilter.notifyType = CDPEvent.CDPEventNotifyType.ONEP_CDP_ALL
ifFilter = InterfaceFilter()
clientData = None
network_element = tutorial.get_network_element()
print &quot;Adding CDP listener to network element&quot;
event_handle = network_element.add_cdp_listener(cdpListener, ifFilter, cdpFilter, clientData)
</pre>
</div>
<p>You can then remove the listener by passing back the integer that you just received to the corresponding remove listener method. <tt>NOTE</tt> The listener is removed automatically once the onePK application terminates.</p>
</div>
<div class="section"><h3><a name="Remove_Listener">Remove Listener</a></h3>
<div class="source"><pre class="prettyprint">cdpListener = ExampleNeCDPListener(&quot;CDP Tutorial&quot;)
cdpFilter = CDPFilter()
cdpFilter.notifyType = CDPEvent.CDPEventNotifyType.ONEP_CDP_ALL
ifFilter = InterfaceFilter()
clientData = None
network_element = tutorial.get_network_element()
print &quot;Adding CDP listener to network element&quot;
event_handle = network_element.add_cdp_listener(cdpListener, ifFilter, cdpFilter, clientData)
</pre>
</div>
<p>By using the same network_element object, you can register multiple listeners with the same network_element. For a complete list of listener types that can be added to the network_element object, see the onePK network_element ePydoc documentation.</p>
</div>
</div>
<div class="section"><h2><a name="Result">Result</a></h2>
<p>Congratulations! By following this tutorial, you can now model an events listener on a network element.</p>
</div>
<div class="section"><h2><a name="Next_Steps">Next Steps</a></h2>
<ul><li><a href="./CLIEventTutorial.html">CLI Events Tutorial</a></li>
<li><a href="./OIREventTutorial.html">OIR Events Tutorial</a></li>
<li><a href="./SyslogEventTutorial.html">Syslog Events Tutorial</a></li>
<li><a href="../NetworkInterface/networkinterfacetutorial.html">Basic Network Interface Tutorial</a></li>
<li><a href="../NetworkInterface/interfaceaddresstutorial.html">Interface Address Tutorial</a></li>
<li><a href="../NetworkInterface/interfacestatechangetutorial.html">Interface State Change Tutorial</a></li>
<li><a href="../NetworkInterface/interfacestatisticstutorial.html">Interface Statistics Tutorial</a></li>
</ul>
</div>

                  </div>
            </div>
      
    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                   2014.
          All Rights Reserved.      
            
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
