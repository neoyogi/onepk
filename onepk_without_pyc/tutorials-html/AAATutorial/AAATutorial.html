<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--
 | Generated by Apache Maven Doxia at Aug 18, 2014
 | Rendered using Apache Maven Fluido Skin 1.2.2
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>onePK Python Tutorials - AAA Tutorial - Using the AAA Service Set</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido.min.js"></script>

    
    <meta http-equiv="Content-Language" content="en" />
            </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>onePK Python Tutorials</h2>
                </div>
                      </div>
        <div class="pull-right">                  <a href="http://www.cisco.com/go/onepk" id="bannerRight">
                                                                                                <img src="../images/cisco-logo.png" />
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
            
                  <li id="publishDate">Last Published: 2014-08-18</li>
                  <li class="divider">|</li> <li id="projectVersion">Version: 1.3.0.181</li>
                      
                
            
      
                            </ul>
      </div>

            <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
                
            
                                    <h3>Main</h3>
                  <ul>
                  <li class="none">
                          <a href="../index.html" title="Home">Home</a>
            </li>
          </ul>
                        <h3>Tutorials</h3>
                  <ul>
                  <li class="none">
                          <a href=".././basetutorial.html" title="Connecting to a Network Element">Connecting to a Network Element</a>
            </li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <li class="expanded">
                          <a href="../index.html#Base_Service_Set_Tutorials" title="Base Service Set Tutorials">Base Service Set Tutorials</a>
                    <ul>
                                                                        <li class="collapsed">
                          <a href="../SessionTutorial/SessionTutorials.html" title="Session Handling">Session Handling</a>
                  </li>
                                                                                                            <li class="collapsed">
                          <a href="../NetworkElement/networkelement.html" title="Element">Element</a>
                  </li>
                                                                                                                                                <li class="collapsed">
                          <a href="../NetworkInterface/networkinterface.html" title="Network Interface">Network Interface</a>
                  </li>
                                                                                                                                                                  <li class="collapsed">
                          <a href="../Events/events.html" title="Events">Events</a>
                  </li>
                                                                                          <li class="collapsed">
                          <a href="../Discovery/discovery.html" title="Discovery">Discovery</a>
                  </li>
                                                                                          <li class="collapsed">
                          <a href="../Management/management.html" title="Application CLI Extension">Application CLI Extension</a>
                  </li>
                                                                                                    <li class="expanded">
                          <a href="../AAATutorial/AAAOverview.html" title="AAA">AAA</a>
                    <ul>
                      <li class="none">
                          <a href="../AAATutorial/AAAConfiguration.html" title="AAA Configuration">AAA Configuration</a>
            </li>
                      <li class="none">
            <strong>AAA Tutorial</strong>
          </li>
              </ul>
        </li>
                                                                        <li class="collapsed">
                          <a href="../VTYTutorial/vty.html" title="VTY">VTY</a>
                  </li>
                                                                                          <li class="collapsed">
                          <a href="../Policy/policy.html" title="Policy">Policy</a>
                  </li>
                                                                                          <li class="collapsed">
                          <a href="../Routing/routing.html" title="Routing">Routing</a>
                  </li>
                                                                        <li class="collapsed">
                          <a href="../Location/location.html" title="Location">Location</a>
                  </li>
                                                                        <li class="collapsed">
                          <a href="../Identity/identity.html" title="Identity">Identity</a>
                  </li>
              </ul>
        </li>
          </ul>
                      
            
                
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
        <div id="bodyColumn"  class="span10" >
                                  
            <div class="section"><h2><a name="AAA_Tutorial">AAA Tutorial</a></h2>
<p><a href="https://communities.cisco.com/community/developer/networking/cisco-one/onepk" class="externalLink">For questions, read the onePK Forums</a></p>
<p><b>Contents</b></p>
<ul><li><a href="#AAA_Tutorial">AAA Tutorial</a></li>
<li><a href="#Goal">Goal</a></li>
<li><a href="#Tutorial_Code">Tutorial Code</a></li>
<li><a href="#RequirementsPrerequisites">Requirements/Prerequisites</a></li>
<li><a href="#Steps_In_Detail">Steps In Detail</a><ul><li><a href="#Identifying_the_Application_for_Authorization">Identifying the Application for Authorization</a></li>
<li><a href="#Instantiating_and_Authenticating_a_User">Instantiating and Authenticating a User</a></li>
<li><a href="#Retrieving_AAA_Server_Last_Request_Information">Retrieving AAA Server Last Request Information</a></li>
<li><a href="#Accessing_Authorization_and_Accounting_Services">Accessing Authorization and Accounting Services</a></li>
</ul>
</li>
<li><a href="#Result">Result</a></li>
<li><a href="#Next_Steps">Next Steps</a></li>
</ul>
</div>
<div class="section"><h2><a name="Goal">Goal</a></h2>
<p>This tutorial demonstrates the onePK AAA (Authentication, Authorization, and Accounting) Service Set. The AAA Service Set provides AAA client functionality to onePK applications.</p>
<p>You will learn how to authenticate a user, how to read the user's authorization attributes configured on the AAA server, and how to send accounting requests to the AAA server.</p>
</div>
<div class="section"><h2><a name="Tutorial_Code">Tutorial Code</a></h2>
<p>The code used in this tutorial is located under &lt;SDK Location&gt;/python/tutorials/aaa.</p>
</div>
<div class="section"><h2><a name="RequirementsPrerequisites">Requirements/Prerequisites</a></h2>
<p>These steps assume the application can connect properly to a network element. Please see the <a href="../basetutorial.html">Connecting to a Network Element</a> tutorial for information on how to make the initial connection.</p>
<p>The AAA server must first be configured with the necessary users and user authorization profiles for the application. The network element which the application connects to must also be configured to use the AAA server. For detailed steps on how to accomplish this, please see <a href="./AAAConfiguration">AAA Configuration</a>.</p>
</div>
<div class="section"><h2><a name="Steps_In_Detail">Steps In Detail</a></h2>
<div class="section"><h3><a name="Identifying_the_Application_for_Authorization">Identifying the Application for Authorization</a></h3>
<p>In order for a user to be granted application-specific authorization, the application name specified here must match the application name in the attributes configured on the AAA server. It is important to use a name that uniquely identifies the application. AAA service set APIs require an established connection to the network element.</p>
<p>For more information on setting the application name and connecting to the network element, please see the <a href="../basetutorial.html">Connecting to a Network Element</a> tutorial.</p>
<div class="source"><pre class="prettyprint">tutorial.connect(&quot;com.cisco.onep.tutorials.aaa.AAATutorial&quot;)
</pre>
</div>
</div>
<div class="section"><h3><a name="Instantiating_and_Authenticating_a_User">Instantiating and Authenticating a User</a></h3>
<p>Instantiate a User that holds a AAA user's attributes. The AAA user is associated with one network element, and the association can be changed using set_network_element(). The AAA user must authenticate to the AAA server prior to using other AAA services. During authentication, the application can supply an optional list of attributes if required by the AAA server.</p>
<div class="source"><pre class="prettyprint">aaaUser = User(tutorial.network_element,
               tutorial.username,
               tutorial.password)
</pre>
</div>
<div class="source"><pre class="prettyprint">#  Authenticate without supplying any additional attributes.
aaaAttributeList = aaaUser.authenticate(None)
</pre>
</div>
</div>
<div class="section"><h3><a name="Retrieving_AAA_Server_Last_Request_Information">Retrieving AAA Server Last Request Information</a></h3>
<p>We can get information about the AAA server that served the last request using this API.</p>
<div class="source"><pre class="prettyprint">server = aaaUser.server
logger.info(&quot;IP address: &quot; + server.address)
logger.info(&quot;Protocol: &quot; + server.protocol)
</pre>
</div>
</div>
<div class="section"><h3><a name="Accessing_Authorization_and_Accounting_Services">Accessing Authorization and Accounting Services</a></h3>
<p>After successfully authenticating, authorization and accounting services may be accessed. If you are interested in using these services, read on. Otherwise, you may skip till the end of the tutorial.</p>
<p>Accounting records may be sent manually unless auto-accounting is enabled for the user.</p>
<div class="source"><pre class="prettyprint">if aaaUser.is_auto_acct_enabled:
    logger.info(&quot;Auto-accounting is enabled.&quot;)
else:
    logger.info(&quot;Auto-accounting is not enabled.&quot;)
    try:
        aaaUser.send_accounting_record(
            User.OnepAAAAcctAction.ONEP_AAA_ACCT_ACTION_START, None)
    except OnepException as e:
        logger.error(e)
</pre>
</div>
<p>Allowed actions are returned separate from the authorization profile. Here, we check if the user is allowed to perform the requested action.</p>
<div class="source"><pre class="prettyprint">if not aaaUser.is_action_authorized(nextLine):
    print &quot;You are not allowed to perform this action.&quot;
    continue
</pre>
</div>
<p>If the AAA server is configured with app-specific attributes, we can get them from the authorization profile. Here, we read the app attribute &quot;custom&quot; from the attribute list.</p>
<div class="source"><pre class="prettyprint">if nextLine == &quot;custom&quot;:
    for attribute in aaaAttributeList:
        if (attribute.type_ ==
                OnepAAAAttributeType.ONEP_AAA_AT_APP_ATTR
                and attribute.name == &quot;aaa-tutorial-custom&quot;
                and isinstance(attribute, StringAttribute)):
            #  Print the message for the custom action.
            print &quot;You &quot; + attribute.str_value
            break
    else:
        print &quot;Custom action not found.&quot;
    continue
</pre>
</div>
<p>When auto-accounting is enabled, accounting stops when the application disconnects from the network element. Otherwise, the application can manually send a &quot;stop&quot; request.</p>
<div class="source"><pre class="prettyprint">aaaUser.send_accounting_record(
    nepAAAAcctAction.ONEP_AAA_ACCT_ACTION_STOP, None)
</pre>
</div>
</div>
</div>
<div class="section"><h2><a name="Result">Result</a></h2>
<p>Congratulations! You have authenticated a user with a AAA server, read the user's authorization profile attributes, and sent accounting requests to the AAA server.</p>
<p>To try out this tutorial code by compiling and running it, you can find the code located at: &lt;SDK Location&gt;/python/tutorials/aaa/.</p>
</div>
<div class="section"><h2><a name="Next_Steps">Next Steps</a></h2>
<ul><li><a href="../Events/events.html">Events Tutorials</a></li>
<li><a href="../NetworkInterface/networkinterfacetutorial.html">Network Interface Tutorial</a> </li>
<li><a href="../NetworkInterface/interfaceaddresstutorial.html">Interface Address Tutorial</a></li>
<li><a href="../NetworkInterface/interfacestatechangetutorial.html">Interface State Change Tutorial</a></li>
<li><a href="../NetworkInterface/interfacestatisticstutorial.html">Interface Statistics Tutorial</a></li>
</ul>
</div>

                  </div>
            </div>
      
    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                   2014.
          All Rights Reserved.      
            
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
